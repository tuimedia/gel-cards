<!doctype html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <title>gel component template</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <link rel="import" href="templates/card--video.html">
    <link rel="import" href="templates/card--audio.html">
    <link rel="import" href="templates/card--gallery.html">
    <link rel="import" href="templates/card--poll.html">
    <link rel="import" href="templates/card--story.html">
    <link rel="import" href="templates/card--video.html">

    <!-- build:css(.) styles/vendor.css -->
    <!-- bower:css -->
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css(.tmp) styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <!-- endbuild -->
  </head>
  <body>

    <div class="gel-wrap">

      <h1>GEL Cards</h1>

      <div class="flexbox flexbox--flex-cell">


      </div>

    </div>

    <!-- build:js(.) scripts/vendor.js -->
    <!-- bower:js -->
    <!-- endbower -->
    <!-- endbuild -->

    <!-- build:js scripts/main.js -->
    <script src="scripts/jquery.js"></script>
    <script src="scripts/handlebars.js"></script>
    <script src="scripts/main.js"></script>
    <!-- endbuild -->



    <script id="entry-template" type="text/x-handlebars-template">
      <div class="entry">
        <h1>{{title}}</h1>
        <div class="body">
          {{body}}
        </div>
      </div>
    </script>

    <script>
      var templates = {};
      var compiledTemplates = [];
      $.when(

        $.get("../templates/card--video.html#entry-template", function(html) {
          templates.video = $(html);
        }),
        $.get("../templates/card--quote.html", function(html) {
          templates.quote = $($(html).html());
        }),
        $.get("../templates/card--story.html", function(html) {
          templates.story = $($(html).html());
        }),
        $.get("../templates/card--poll.html", function(html) {
          templates.poll = $($(html).html());
        }),
        $.get("../templates/card--gallery.html", function(html) {
          templates.gallery = $($(html).html());
        }),
        $.get("../templates/card--fact.html", function(html) {
          templates.fact = $($(html).html());
        })

      ).then(function() {

        console.log('templates loaded', templates)

        $.getJSON('../data/cards--basic.json', function(result){
          templateStuff(result);
        });

      });


      function templateStuff(data) {

        for (var i = 0; i < data.length; i++) {
          var source = templates[data[i].template].html();
          var template = Handlebars.compile(source);
          var context = data[i];
          var html = template(context);
          compiledTemplates.push(html);
        }

        console.log(compiledTemplates);
        renderComponents();
      }

      var grid = document.querySelectorAll('.flexbox');

      function renderComponents() {

        for (var i = 0; i < compiledTemplates.length; i++) {

          // create grid element
          var $gridEl = $('div');

          $gridEl.addClass('flexbox__item one-whole lap-and-up-one-half desk-one-third');
          $gridEl.append($compiledTemplates[i]);

          grid[0].appendChild(gridEl);
        }

      }

      // getTemplate();
    </script>

  </body>
</html>
